<c-toaster class="p-3" position="fixed" [placement]="placement"></c-toaster>


<div *ngIf="!poap">
    Loading ..
</div>

<div class="row" *ngIf="poap">
    <div class="col-12">
        <div class="card ">
            <div class="card-body" >
			<div class="d-flex justify-content-left">
				<div class="mx-2 px-2">
					<img [src]="poap.logo" alt="event logo"  class="img-fluid img-thumbnail img-rounded"/>
				</div>
				<div class="mx-2 px-2">
					<h3>{{poap.eventName}}</h3>
					<p>{{poap.desc}}</p>

					<div class="text-left my-2" >
							
							<a  class="mx-2" [href]="'mailto:' + poap.email" target="_blank"> 
							  <svg cIcon [name]="'cibEmail'" [title]="'cibEmail'" size="2xl"></svg>
							  {{poap.email}}
							</a>

							<a  class="px-2 mx-2" [href]="poap.website" target="_blank"> 
							  <svg cIcon [name]="'cilBrowser'" [title]="'cilBrowser'" size="2xl"></svg>
							  {{poap.website}}
							</a>
					</div>
				
					<h5 class="mt-3" style="color: #d70bc1">POAPS Minted: {{poap.poapsMinted}} of {{poap.maxCapacity}}</h5>
				</div>
				
			</div>
			
                               

            </div>
        </div>

        <div class="card mt-4" *ngIf="isOwner===true">
            <div class="card-header d-flex justify-content-between">
                <h3>Manage POAP</h3>
				
			
            </div>
            <div class="card-body" >
                <div>
                    <h4>POAP Claim Link: http://localhost:4200/poaps/d/{{poapId}}</h4>

                    <p class="text-muted">Copy this link and send to anyone who deserves this poap</p>
                </div>
                <button class="btn btn-primary mx-2 my-2" (click)="openEmailModal()">Email Link to Attendees</button>

                <button *ngIf="poap.isOpenForClaim===true" class="btn btn-success mx-2 my-2" (click)="enableDisable(false)">Disable POAP Claim</button>
                <button *ngIf="!poap.isOpenForClaim" class="btn btn-success mx-2 my-2" (click)="enableDisable(true)">Enable POAP Claim</button>

            </div>
        </div>
    </div>
	
	<div class="my-3 card" *ngIf="!isOwner">
		
		<div class="card-body">
			<div class="my-3 text-center" *ngIf="isPoapOwner">
		
				<img [src]="poap.logo" alt="event logo"  class="img-fluid rounded-circle"/>
				<h4>Congratulations, You own this POAP</h4>

                <button class="btn btn-primary mx-2 my-2" *ngIf="!isOwnerPOAPListedOnMarket" (click)="openListFormModal()">List on POAP Market</button>

                <div *ngIf="isOwnerPOAPListedOnMarket">
                    <button class="btn btn-primary mx-2 my-2"  >View on POAP Market</button>
                    <button class="btn btn-primary mx-2 my-2"  (click)="delistOnMarket()">Delist on POAP Market</button>
                </div>
			</div>
			
			<div class="my-3" *ngIf="!isPoapOwner ">
				<div *ngIf="!poap.isOpenForClaim">
			
					<h4>You don't own this POAP</h4>
				</div>
				<div *ngIf="poap.isOpenForClaim">
			
					<h4>You don't own this POAP, Mint One now</h4>
					
					<button class="btn btn-primary mx-2 my-2" (click)="openMintFormModal()">Mint</button>
				</div>
				
			</div>
		</div>
		
	</div>
	
    

	<div *ngIf="poapOwners" class="my-3 card">
		<div class="card-body">
			<table class="table">
			  <thead>
				<tr>
				  <th scope="col">#</th>
				  <th scope="col">Address</th>
				  <th scope="col">Token ID</th>
				  <th scope="col"></th>
				</tr>
			  </thead>
			  <tbody>
			  
				<tr *ngIf="poapOwners.length<1">
				  <th scope="row">0</th>
				  <td colspan="2">No Minted POAP yet</td>
				  
				  <td></td>
				</tr>
				<tr *ngFor="let poapOwner of poapOwners; let i = index">
				  <th scope="row">{{i}}</th>
				  <td>{{poapOwner.owner}}</td>
				  <td>{{poapOwner.tokenId}}</td>
				  <td><button  class="btn btn-info mx-1 my-1" >View on Explorer</button></td>
				</tr>
				
			  </tbody>
			</table>
		</div>
	
	</div>

</div>



<c-modal id="emailListModal" [visible]="emaiListModalVisible" >
    <c-modal-header>
      <h5 cModalTitle>Email Your Attendees</h5>
      <button (click)="closeEmailModal()" cButtonClose>x</button>
    </c-modal-header>
  
    <c-modal-body>
    
        <div class="row">
            <div class="col">
                <div class="alert alert-info">
                    All attendees that get the Mint Link will be ble to claim ther POAP.
                </div>
            </div>
        </div>

      <form *ngIf="emailListFormGroup"  [formGroup]="emailListFormGroup" class="email-form needs-validation"  novalidate [validated]="false"  cForm>
          <div class="row">
		  
			<div class="col-12">
                <div [cFormFloating]="true" class="my-3" >
                    <input cFormControl id="emailListEventCode"  placeholder="" formControlName="mintEventCode" type="text"  sizing="sm"  [ngClass]="{ 'is-invalid': emailListFormGroup.get('mintEventCode').touched && emailListFormGroup.get('mintEventCode').invalid, 'is-valid': emailListFormGroup.get('mintEventCode').touched && emailListFormGroup.get('mintEventCode').valid }"/>
                    <label cLabel for="mintPoapEventCode">Event Code</label>
                    
                    <div cFormText class="mt-2">
                        Enter the Event Code you used when you created this Event
                    </div>

                    <div class="error-message" *ngIf="emailListFormGroup.get('mintEventCode').invalid && emailListFormGroup.get('mintEventCode').touched">
                        <div *ngFor="let error of  objectKeys(emailListFormGroup.get('mintEventCode')?.errors)">                                        
                        {{validationMessages.mintEventCode[error]}}
                        </div>
                    </div>

                </div>
            </div>
              
              <div class="col-12" >
                  <div [cFormFloating]="true" class="my-3" >
                    <textarea cFormControl style="height: 100px;font-size: 1.15rem" rows="3" id="email-list" placeholder="" formControlName="addresses" type="text" sizing="lg" [ngClass]="{ 'is-invalid': emailListFormGroup.get('addresses').touched && emailListFormGroup.get('addresses').invalid, 'is-valid': emailListFormGroup.get('addresses').touched && emailListFormGroup.get('addresses').valid }">
                    </textarea>
                    <label cLabel for="emil-list">Email Addresses (Enter each Email address on a separate line or separated by comma)</label>
                      
                    <div cFormText class="mt-2">
                        Anyone with the Mint link will be able to claim a POAP <br/>
                        
                        <!--<div class="alert alert-info">Submitting a new whitelist will overwrite any existing whitelist</div>-->
                    </div>
  
                      <div class="error-message" *ngIf="emailListFormGroup.get('addresses').invalid && emailListFormGroup.get('addresses').touched">
                          <div *ngFor="let error of  objectKeys(emailListFormGroup.get('addresses')?.errors)">                                        
                          {{validationMessages.emaillistAddresses[error]}}
                          </div>
                      </div>
  
                  </div>
              </div>
              
  
          </div>
      </form>
    </c-modal-body>
  
    <c-modal-footer>
        
      <button (click)="closeEmailModal()" cButton color="secondary">
        Close
      </button>
      <button class="btn btn-primary" *ngIf="emailListFormGroup" [disabled]="emailListFormGroup.invalid " (click)="emailList()">Email</button>
    </c-modal-footer>
</c-modal>


<c-modal id="mintPoapModal" [visible]="mintPoapModalVisible" >
  <c-modal-header>
    <h5 cModalTitle>Mint your POAP</h5>
    <button (click)="closeMintFormModal()" cButtonClose>x</button>
  </c-modal-header>

  <c-modal-body>
    <form *ngIf="mintPoapFormGroup"  [formGroup]="mintPoapFormGroup" class="mint-form needs-validation"  novalidate [validated]="false"  cForm>
        <div class="row">
            <div class="col-12">
                <div [cFormFloating]="true" class="my-3" >
                    <input cFormControl id="mintPoapEventCode"  placeholder="" formControlName="mintEventCode" type="text"  sizing="sm"  [ngClass]="{ 'is-invalid': mintPoapFormGroup.get('mintEventCode').touched && mintPoapFormGroup.get('mintEventCode').invalid, 'is-valid': mintPoapFormGroup.get('mintEventCode').touched && mintPoapFormGroup.get('mintEventCode').valid }"/>
                    <label cLabel for="mintPoapEventCode">Event Code</label>
                    
                    <div cFormText class="mt-2">
                        Enter the Evevnt Code sent to you in the email you received
                    </div>

                    <div class="error-message" *ngIf="mintPoapFormGroup.get('mintEventCode').invalid && mintPoapFormGroup.get('mintEventCode').touched">
                        <div *ngFor="let error of  objectKeys(mintPoapFormGroup.get('mintEventCode')?.errors)">                                        
                        {{validationMessages.mintEventCode[error]}}
                        </div>
                    </div>

                </div>
            </div>
                       

        </div>
    </form>
  </c-modal-body>

  <c-modal-footer>
    <button (click)="closeMintFormModal()" class="btn btn-secondary">
      Close
    </button>
    <button class="btn btn-primary" *ngIf="mintPoapFormGroup" [disabled]="mintPoapFormGroup.invalid " (click)="mintPoap()">Mint</button>
  </c-modal-footer>
</c-modal>


<c-modal id="listPoapOnMarketPlaceModal" [visible]="listPoapOnMarketModalVisible" >
  <c-modal-header>
    <h5 cModalTitle>Sell/List your POAP</h5>
    <button (click)="closeListFormModal()" cButtonClose>x</button>
  </c-modal-header>

  <c-modal-body>
    <form *ngIf="listPoapForSaleFormGroup"  [formGroup]="listPoapForSaleFormGroup" class="mint-form needs-validation"  novalidate [validated]="false"  cForm>
        <div class="row">
            <div class="col-10">
                <div [cFormFloating]="true" class="my-3" >
                    <input cFormControl id="salePrice"  placeholder="" formControlName="salePrice" type="text"  sizing="sm"  [ngClass]="{ 'is-invalid': listPoapForSaleFormGroup.get('salePrice').touched && listPoapForSaleFormGroup.get('salePrice').invalid, 'is-valid': listPoapForSaleFormGroup.get('salePrice').touched && listPoapForSaleFormGroup.get('salePrice').valid }"/>
                    <label cLabel for="salePrice">List Price</label>
                    
                    <div cFormText class="mt-2">
                        Enter the Price you will like to sell this POAP.
                    </div>

                    <div class="error-message" *ngIf="listPoapForSaleFormGroup.get('salePrice').invalid && listPoapForSaleFormGroup.get('salePrice').touched">
                        <div *ngFor="let error of  objectKeys(listPoapForSaleFormGroup.get('salePrice')?.errors)">                                        
                        {{validationMessages.salePrice[error]}}
                        </div>
                    </div>

                </div>
            </div>

            <div class="col-2 text-left">
                <div class="my-5">CELO</div>
            </div>
                       

        </div>
    </form>
  </c-modal-body>

  <c-modal-footer>
    <button (click)="closeListFormModal()" class="btn btn-secondary">
      Close
    </button>
    <button class="btn btn-primary" *ngIf="listPoapForSaleFormGroup" [disabled]="listPoapForSaleFormGroup.invalid " (click)="listPoap()">List</button>
  </c-modal-footer>
</c-modal>





<!--
  <c-modal id="viewWhitelistModal" [visible]="viewWhitelistModalVisible" >
    <c-modal-header>
      <h5 cModalTitle>View Whitelist</h5>
      <button (click)="closeViewWhitelistModal()" cButtonClose>x</button>
    </c-modal-header>
  
    <c-modal-body>
    
        <div class="row" *ngIf="whitelist">
            <div class="col">

                <ol class="list-group list-group-numbered mt-4" >
                    <li *ngIf="whitelist.length<1" class="list-group-item ">
                        No Address in Whitelist
                    </li>
                    <li *ngFor="let add of whitelist" class="list-group-item " style="font-weight: bold;">
                        {{add}}
                    </li>


                </ol>
            </div>
        </div>

    </c-modal-body>
  
    <c-modal-footer>
        
      <button (click)="closeViewWhitelistModal()" cButton color="secondary">
        Close
      </button>
      
    </c-modal-footer>
  </c-modal> -->



  